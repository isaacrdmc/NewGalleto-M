{% extends "ventas/base_ventas.html" %}

{% block content %}
<style>
    .seccion {
        background-color: #ffffff;
        padding: 20px;
        border-radius: 10px;
        margin-bottom: 20px;
    }

    .seccion-compacta {
      width: 55%;
      border-radius: 10px;
      margin-bottom: 20px;
  }

  .seccion-compacta-total {
    width: 70%;
    border-radius: 10px;
    margin-bottom: 20px;
    margin-top: -220px;
    margin-left: 400px;
}
  

    .titulo {
        text-align: center;
        font-weight: bold;
        font-size: 40px;
        margin: 30px 0;
    }

    .input-sm {
        width: 100px;
    }

    .btn-checkmark {
        background-color: #8bc34a;
        border: none;
        padding: 10px 20px;
        color: white;
        font-weight: bold;
        border-radius: 5px;
    }

    table {
      width: 100%;
      border-collapse: collapse;
  }
  th {
      background-color: #f8b74a;
      padding: 10px;
      text-align: center;
      font-weight: bold;
  }
  td {
      background-color: #f9f9f9;
      padding: 10px;
      text-align: center;
      border-bottom: 1px solid #e0e0e0;
  }

    .btn-eliminar {
        background-color: #e74c3c;
        border: none;
        padding: 5px 10px;
        border-radius: 5px;
        color: white;
    }

    .total-box {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        text-align: center;
        font-size: 24px;
        font-weight: bold;
    }

    .btn-aceptar {
        background-color: #8bc34a;
        color: white;
        font-weight: bold;
        font-size: 20px;
        border: none;
        padding: 10px 30px;
        margin-top: 15px;
        border-radius: 5px;
    }
</style>

<h1 class="titulo">Generar venta</h1>

<div class="container">
    <!-- M√©todo de venta -->
    <div class="seccion seccion-compacta">
      <h5><strong>M√©todo de venta</strong></h5>
      <select class="form-select w-auto" id="metodoVentaSelect">
          <option selected>Por gramo</option>
          <option>Por unidad</option>
          <option>Empacado</option>
      </select>
  </div>   
    <!-- Detalle de venta -->
    <div class="seccion seccion-compacta">
        <h5><strong>Detalle de venta</strong></h5>
        <form class="row g-3 align-items-center">
            <div class="col-auto">
                <label for="galleta" class="col-form-label">Galleta:</label>
                <select id="galleta" class="form-select">
                    <option selected disabled>Selecciona una galleta</option>
                </select>
            </div>
            <div class="col-auto">
                <label for="cantidad" class="col-form-label">Cantidad:</label>
                <select id="cantidad" class="form-select input-sm">
                    <option selected disabled>Selecciona cantidad</option>
                </select>
            </div>
            <div class="col-auto">
                <label for="gramos" class="col-form-label">Gramos:</label>
                <input type="text" id="gramos" class="form-control input-sm" value="50gr">
            </div>
            <div class="col-auto">
                <label for="subtotal" class="col-form-label">Subtotal:</label>
                <input type="text" id="subtotal" class="form-control input-sm">
            </div>
            <div class="col-auto d-flex align-items-end">
                <button type="submit" class="btn btn-checkmark">‚úîÔ∏è</button>
            </div>
        </form>
    </div>

    <!-- Total -->
    <div class="row mb-4 seccion-compacta-total">
        <div class="col-md-6 offset-md-6">
            <div class="total-box">
                Total<br>$0.00
                <br>
                <button class="btn-aceptar mt-3">‚úîÔ∏è Aceptar</button>
            </div>
        </div>
    </div>

    <!-- Tabla de ventas -->
        <table>
            <thead>
                <tr>
                    <th>M√©todo de venta</th>
                    <th>Galleta</th>
                    <th>Cantidad</th>
                    <th>Subtotal</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>Por gramos</td>
                    <td>Nuez</td>
                    <td>100</td>
                    <td>100.00</td>
                    <td>
                        <button class="btn-eliminar">üóëÔ∏è</button>
                    </td>
                </tr>
                <tr>
                    <td>Por unidad</td>
                    <td>Chocolate</td>
                    <td>100</td>
                    <td>100.00</td>
                    <td>
                        <button class="btn-eliminar">üóëÔ∏è</button>
                    </td>
                </tr>
            </tbody>
        </table>
</div>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        const galletaSelect = document.getElementById('galleta');
        const cantidadSelect = document.getElementById('cantidad');
        const metodoVenta = document.getElementById('metodoVentaSelect');

        // Cargar galletas al iniciar
        fetch('/ventas/galletas_disponibles')
            .then(response => response.json())
            .then(data => {
                data.forEach(g => {
                    const option = document.createElement('option');
                    option.value = g.id;
                    option.textContent = g.nombre;
                    galletaSelect.appendChild(option);
                });
            });

        // Escuchar cambio de galleta para actualizar cantidad
        galletaSelect.addEventListener('change', () => {
            const idGalleta = galletaSelect.value;
            const metodo = metodoVenta.value;

            // Si se seleccion√≥ una galleta y la venta es por unidad
            if (idGalleta && metodo === 'Por unidad') {
                fetch(`/ventas/galleta/${idGalleta}`)
                    .then(res => res.json())
                    .then(data => {
                        if (data.success) {
                            const max = Math.min(data.cantidadDisponible, data.cantidadDisponible); // opcional: limitar a 20
                            cantidadSelect.innerHTML = '<option selected disabled>Selecciona cantidad</option>';
                            for (let i = 1; i <= max; i++) {
                                const opt = document.createElement('option');
                                opt.value = i;
                                opt.textContent = i;
                                cantidadSelect.appendChild(opt);
                            }
                        }
                    });
            }
        });

        // Escuchar cambio de m√©todo de venta
        metodoVenta.addEventListener('change', () => {
            const metodo = metodoVenta.value;
            cantidadSelect.innerHTML = '<option selected disabled>Selecciona cantidad</option>';

            if (metodo === 'Por unidad') {
                // No hace nada a√∫n, espera a que el usuario seleccione una galleta
            } else if (metodo === 'Por gramo') {
                ['50gr', '100gr', '150gr', '200gr', '250gr'].forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val;
                    cantidadSelect.appendChild(option);
                });
            } else if (metodo === 'Empacado') {
                ['Caja 700gr', 'Caja 1kg'].forEach(val => {
                    const option = document.createElement('option');
                    option.value = val;
                    option.textContent = val;
                    cantidadSelect.appendChild(option);
                });
            }
        });
    });
</script>    
{% endblock %}