{% extends "layout.html" %}

{% block content %}
<!-- Navbar -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">
        <!-- Logo de la empresa a la izquierda -->
        <a class="navbar-brand" href="{{ url_for('index') }}">
            <img src="{{ url_for('static', filename='img/logo3.png') }}" alt="Logo" class="d-inline-block align-text-top">
        </a>

        {% if not 'username' in session %}
        <div class="navbar-brand mx-auto text-center">
            <h3 class="mb-0">Iniciar Sesión</h3>
        </div>
        {% endif %}

        {% if 'username' in session %}
        <div class="navbar-nav ms-auto">
            <span class="navbar-text me-3">
                Bienvenido, {{ session['username'] }}
            </span>
            <a class="btn btn-outline-light" href="{{ url_for('logout') }}">Cerrar Sesión</a>
        </div>
        {% endif %}
    </div>
</nav>

<div class="login-container">
    <!-- Pestañas -->
    <div class="tabs">
        <div class="tab active prod" onclick="changeTab('Producción', this)">Producción</div>
        <div class="tab inactive pes" onclick="changeTab('Ventas', this)">Ventas</div>
        <div class="tab inactive pes" onclick="changeTab('Cliente', this)">Cliente</div>
    </div>

    <!-- Contenedor de Login -->
    <div class="login-box">
        <h2 id="tab-title">Producción</h2>
        <form method="POST" action="{{ url_for('login') }}">
            <label for="username">Usuario:</label>
            <input type="text" name="username" placeholder="Usuario" class="input-box" required>
            <label for="password">Contraseña:</label>
            <input type="password" name="password" placeholder="Contraseña" class="input-box" required>
            <button type="submit" class="btn">Ingresar</button>
        </form>
    </div>
</div>

<script>
    let activeTab = 'Producción'; // Pestaña activa por defecto

    // Cambia la pestaña activa
    function changeTab(tabName, element) {
        activeTab = tabName; // Actualiza la pestaña activa
        const tabs = document.querySelectorAll('.tab');
        tabs.forEach(tab => tab.classList.remove('active')); // Elimina la clase "active" de todas las pestañas
        tabs.forEach(tab => tab.classList.add('inactive')); // Agrega la clase "inactive" a todas las pestañas
        element.classList.remove('inactive'); // Elimina la clase "inactive" de la pestaña seleccionada
        element.classList.add('active'); // Agrega la clase "active" a la pestaña seleccionada
        document.getElementById('tab-title').innerText = tabName; // Cambia el título del formulario
    }

    // Verifica si se puede iniciar sesión según la pestaña activa
    document.querySelector('form').addEventListener('submit', function(event) {
        const usernameInput = document.querySelector('input[name="username"]');
        const passwordInput = document.querySelector('input[name="password"]');

        // Si el usuario es admin y está en la pestaña de "Cliente", no permitir el login
        if (activeTab === 'Cliente' && usernameInput.value === 'admin') {
            alert('No se puede iniciar sesión como administrador en la pestaña de Cliente.');
            event.preventDefault(); // Detiene el envío del formulario
            return false;
        }

        // Si el usuario es admin y está en la pestaña de "Producción" o "Ventas", dejar continuar
        if (usernameInput.value === 'admin' && (activeTab === 'Producción' || activeTab === 'Ventas')) {
            return true;
        }

        return true; // Permitir que continúe si no es admin o está en la pestaña correcta
    });
</script>

{% endblock %}
